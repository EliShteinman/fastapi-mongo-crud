### **קובץ הדרכה: `docs/02_core_logic_and_models.md`**

#### **1. מטרת השלב**

מטרת שלב זה היא לבנות את ליבת הלוגיקה והנתונים של האפליקציה. אנו יוצרים שלושה רכיבים מרכזיים: מערכת ניהול הגדרות, מודל הנתונים המגדיר "פריט" (`Item`), והקוד שמחבר את האפליקציה למסד הנתונים MongoDB. שלב זה מכין את הקרקע לכתיבת ה-API עצמו.

---

#### **2. הסבר מעמיק על הפעולות שבוצעו**

1.  **ניהול הגדרות (`app/core/config.py`):**
    *   **מטרה:** קובץ זה מרכז את כל הגדרות האפליקציה. גישה זו חיונית ליצירת אפליקציה ניידת שניתן להריץ בסביבות שונות (פיתוח מקומי, ייצור) על ידי שינוי ההגדרות בלבד, מבלי לגעת בקוד.
    *   **בחירה טכנולוגית (`pydantic-settings`):** ספרייה זו נבחרה כדי לטעון הגדרות ממשתני סביבה בצורה אוטומטית ובטוחה. היא מאמתת שסוג הנתונים של ההגדרות נכון (למשל, שמחרוזת חיבור היא אכן מחרוזת) ומונעת שגיאות. היא מאפשרת לנו להפריד מידע רגיש מהקוד, שיוזן מאוחר יותר דרך `Secrets` של OpenShift.
    *   **ערכי ברירת מחדל:** הגדרנו ערכים כמו `mongodb://localhost:27017` שישמשו אך ורק לפיתוח מקומי.

2.  **מודל הנתונים (`app/models/item.py`):**
    *   **מטרה:** קובץ זה הוא ה"שרטוט" של הנתונים שלנו. הוא מגדיр גם איך נתונים נראים במסד הנתונים וגם איך הם נראים בתקשורת API.
    *   **`Item(Document)` (מודל ה-ODM):**
        *   הקלאס `Item` יורש מ-`Document` של ספריית `beanie`. זה הופך אותו למודל שממופה ישירות ל-Collection ב-MongoDB (במקרה זה, collection בשם `items`). בזכות ירושה זו, אנו מקבלים סט שלם של פונקציות CRUD אסינכרוניות (כמו `get`, `find_all`, `insert`, `delete`) "במתנה".
    *   **`ItemCreate`, `ItemUpdate` (סכמות Pydantic):**
        *   אלו קלאסים המשמשים אך ורק לאימות הנתונים הנכנסים מהמשתמש ב-API. ההפרדה בינם לבין מודל ה-DB היא קריטית: `ItemCreate` לא כולל `id` (כי ה-DB יוצר אותו), ו-`ItemUpdate` מגדיר את כל השדות כאופציונליים כדי לאפשר עדכון חלקי.

3.  **לוגיקת החיבור למסד הנתונים (`app/db/database.py`):**
    *   **מטרה:** מודול זה אחראי באופן בלעדי על יצירת והכנת החיבור למסד הנתונים, בהתאם לעקרון האחריות היחידה.
    *   **אתחול אסינכרוני (`async def init_db()`):** פונקציה זו, שתרוץ פעם אחת בעליית השרת, משתמשת ב-`AsyncIOMotorClient` (הדרייבר האסינכרוני) כדי ליצור חיבור ל-MongoDB.
    *   **`init_beanie(...)`**: פונקציה זו "מפעילה" את `beanie`. היא מקבלת את החיבור למסד הנתונים ואת רשימת המודלים שלנו (`[Item]`). פעולה זו מאפשרת ל-Beanie להבין את מבנה הנתונים שלנו ולהכין את כל המיפויים הנדרשים בין הקוד ל-DB.

---

#### **3. חלופות ושיקולים**

*   **שכבת שירות (Service Layer):**
    *   **חלופה:** בפרויקטים מורכבים יותר, נהוג להוסיף "שכבת שירות" בין ה-API ללוגיקת ה-DB (שבמקרה שלנו מיוצגת על ידי `beanie`). שכבה זו מכילה לוגיקה עסקית מורכבת (למשל, חישובים, שליחת התראות, אינטראקציה עם שירותים אחרים).
    *   **שיקול:** לפרויקט CRUD פשוט כמו זה, הוספת שכבת שירות הייתה מוסיפה מורכבות מיותרת. הלוגיקה כאן פשוטה מספיק כדי שה-API יוכל לתקשר ישירות עם ה-ODM.
